<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GM Tube - Radiation Type Simulation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0a0a0a;
            color: white;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }
        #control-panel {
            background: #1a1a1a;
            width: 100%;
            padding: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            border-bottom: 2px solid #333;
            flex-wrap: wrap;
        }
        .mode-selector {
            display: flex;
            background: #000;
            padding: 5px;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .mode-btn {
            padding: 10px 20px;
            border: none;
            background: none;
            color: #888;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }
        .mode-btn.active {
            color: white;
            background: #333;
            border-radius: 5px;
        }
        .alpha-active { color: #ffeb3b !important; }
        .beta-active { color: #00e5ff !important; }
        .gamma-active { color: #e040fb !important; }

        .counter {
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 2rem;
            padding: 5px 15px;
            border: 2px solid #00ff00;
            border-radius: 5px;
            min-width: 100px;
            text-align: center;
        }
        #emit-btn {
            padding: 12px 25px;
            font-weight: bold;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        canvas { background: #050505; cursor: crosshair; }
        .label-box { font-size: 12px; color: #aaa; text-align: center; }
    </style>
</head>
<body>

<div id="control-panel">
    <div class="label-box">RADIATION TYPE<br>
        <div class="mode-selector">
            <button class="mode-btn active alpha-active" onclick="setMode('alpha', this)">ALPHA (α)</button>
            <button class="mode-btn" onclick="setMode('beta', this)">BETA (β)</button>
            <button class="mode-btn" onclick="setMode('gamma', this)">GAMMA (γ)</button>
        </div>
    </div>
    
    <button id="emit-btn" onclick="fireRay()">FIRE RADIATION RAY</button>

    <div class="counter" id="display">0000</div>

    <div class="label-box">TUBE VOLTAGE<br>
        <input type="range" id="voltage" min="400" max="1000" value="600">
    </div>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const display = document.getElementById('display');
const vSlider = document.getElementById('voltage');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight - 100;

let currentMode = 'alpha';
let count = 0;
let particles = [];
let gasAtoms = [];
let pulses = [];
let deadTimeActive = false;

const tube = {
    x: canvas.width * 0.25,
    y: canvas.height * 0.3,
    w: canvas.width * 0.5,
    h: canvas.height * 0.4,
    anodeY: canvas.height * 0.5
};

// Initialize gas atoms
function initGas() {
    gasAtoms = [];
    for(let i=0; i<250; i++) {
        gasAtoms.push({
            x: tube.x + Math.random() * tube.w,
            y: tube.y + Math.random() * tube.h,
            flash: 0
        });
    }
}

class RayParticle {
    constructor(type) {
        this.type = type;
        this.x = 0;
        this.y = tube.y + (Math.random() * (tube.h * 0.6) + tube.h * 0.2);
        this.active = true;
        this.angle = 0; // For gamma wave
        
        // Physics per type
        const settings = {
            alpha: { speed: 4, ionProb: 0.15, size: 6, color: '#ffeb3b' },
            beta:  { speed: 10, ionProb: 0.04, size: 2, color: '#00e5ff' },
            gamma: { speed: 18, ionProb: 0.008, size: 2, color: '#e040fb' }
        };
        Object.assign(this, settings[type]);
    }

    update() {
        this.x += this.speed;
        
        // Check for gas interaction
        if (this.x > tube.x && this.x < tube.x + tube.w) {
            gasAtoms.forEach(atom => {
                let dx = this.x - atom.x;
                let dy = this.y - atom.y;
                if (Math.abs(dx) < 10 && Math.abs(dy) < 10 && Math.random() < this.ionProb) {
                    atom.flash = 15;
                    spawnIonPair(atom.x, atom.y);
                }
            });
        }

        if (this.x > canvas.width) this.active = false;
    }

    draw() {
        ctx.shadowBlur = 5;
        ctx.shadowColor = this.color;
        ctx.fillStyle = this.color;

        if (this.type === 'gamma') {
            // Draw as a wave
            ctx.beginPath();
            for (let i = 0; i < 20; i++) {
                let wx = this.x - i*2;
                let wy = this.y + Math.sin(wx * 0.2) * 10;
                ctx.rect(wx, wy, 2, 2);
            }
            ctx.fill();
        } else {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
            ctx.fill();
        }
        ctx.shadowBlur = 0;
    }
}

class Charge {
    constructor(x, y, type, gen = 0) {
        this.x = x; this.y = y; this.type = type; this.gen = gen;
        this.active = true;
        this.vx = (Math.random() - 0.5) * 3;
        this.vy = (Math.random() - 0.5) * 3;
    }

    update() {
        if (this.type === 'e') {
            let dy = tube.anodeY - this.y;
            this.vy += dy * 0.08;
            this.x += this.vx; this.y += this.vy;

            // Townsend Avalanche
            let dist = Math.abs(dy);
            if (dist < 20 && dist > 2 && this.gen < 4) {
                if (Math.random() < (vSlider.value / 1100)) {
                    particles.push(new Charge(this.x, this.y, 'e', this.gen + 1));
                    this.gen = 99; 
                }
            }
            if (dist < 4) { triggerPulse(); this.active = false; }
        } else {
            let targetY = (this.y < tube.anodeY) ? tube.y : tube.y + tube.h;
            this.vy += (targetY - this.y) * 0.005;
            this.x += this.vx * 0.2; this.y += this.vy * 0.2;
            if (Math.abs(this.y - targetY) < 5) this.active = false;
        }
    }

    draw() {
        ctx.fillStyle = this.type === 'e' ? '#00f2ff' : '#ff4444';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.type === 'e' ? 1.5 : 3, 0, Math.PI*2);
        ctx.fill();
    }
}

function spawnIonPair(x, y) {
    particles.push(new Charge(x, y, 'e'));
    particles.push(new Charge(x, y, 'ion'));
}

function triggerPulse() {
    if (!deadTimeActive) {
        count++;
        display.innerText = count.toString().padStart(4, '0');
        pulses.push({x: tube.x + tube.w, progress: 0});
        deadTimeActive = true;
        setTimeout(() => deadTimeActive = false, 80);
    }
}

function setMode(mode, btn) {
    currentMode = mode;
    document.querySelectorAll('.mode-btn').forEach(b => b.className = 'mode-btn');
    btn.classList.add('active');
    btn.classList.add(mode + '-active');
}

function fireRay() {
    // Fire a burst of 3 particles to simulate a "ray" stream
    for(let i=0; i<3; i++) {
        setTimeout(() => {
            particles.push(new RayParticle(currentMode));
        }, i * 100);
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Labels
    ctx.fillStyle = "#555";
    ctx.font = "bold 16px Arial";
    ctx.fillText("RADIATION SOURCE", 20, tube.anodeY - 40);
    ctx.fillText("GEIGER-MÜLLER TUBE (GAS FILLED)", tube.x, tube.y - 20);

    // Draw Gas
    gasAtoms.forEach(atom => {
        ctx.beginPath();
        if (atom.flash > 0) {
            ctx.fillStyle = `rgba(255, 255, 255, ${atom.flash/10})`;
            atom.flash--;
        } else {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
        }
        ctx.arc(atom.x, atom.y, 2, 0, Math.PI*2);
        ctx.fill();
    });

    // Draw Tube
    ctx.strokeStyle = '#444'; ctx.lineWidth = 4;
    ctx.strokeRect(tube.x, tube.y, tube.w, tube.h);
    
    // Draw Anode
    ctx.strokeStyle = '#ff3333'; ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(tube.x, tube.anodeY); ctx.lineTo(tube.x + tube.w, tube.anodeY);
    ctx.stroke();

    // Connection to counter
    ctx.setLineDash([5, 5]); ctx.strokeStyle = '#333';
    ctx.beginPath();
    ctx.moveTo(tube.x + tube.w, tube.anodeY);
    ctx.lineTo(canvas.width - 100, tube.anodeY);
    ctx.lineTo(canvas.width - 100, 150);
    ctx.stroke();
    ctx.setLineDash([]);

    // Update particles
    particles = particles.filter(p => p.active);
    particles.forEach(p => { p.update(); p.draw(); });

    // Signals
    ctx.strokeStyle = '#00ff00'; ctx.lineWidth = 3;
    pulses.forEach(p => {
        let tx = canvas.width - 100;
        let cx = p.x + (tx - p.x) * p.progress;
        ctx.beginPath();
        ctx.moveTo(cx, tube.anodeY);
        ctx.lineTo(cx - 10, tube.anodeY - 15);
        ctx.lineTo(cx - 20, tube.anodeY + 15);
        ctx.lineTo(cx - 30, tube.anodeY);
        ctx.stroke();
        p.progress += 0.03;
    });
    pulses = pulses.filter(p => p.progress < 1);

    requestAnimationFrame(draw);
}

initGas();
draw();
</script>
</body>
</html>