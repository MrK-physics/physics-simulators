<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuclear Chain Reaction Simulator (Subatomic Detail)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a1a;
            color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }
        h1 { margin-bottom: 5px; color: #4facfe; }
        p { margin-bottom: 15px; color: #aaa; font-size: 0.9em; }
        
        .container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        canvas {
            background-color: #000;
            border: 2px dashed #666; 
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            cursor: crosshair;
            transition: background-color 0.5s ease;
        }

        .controls {
            background-color: #2d2d2d;
            padding: 20px;
            border-radius: 10px;
            width: 320px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .control-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="range"], select { width: 100%; padding: 5px; border-radius: 4px; border: none; }
        
        button {
            width: 100%;
            padding: 10px;
            background-image: linear-gradient(to right, #43e97b 0%, #38f9d7 100%);
            border: none;
            border-radius: 5px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 10px;
        }
        button:hover { opacity: 0.9; }
        button.reset {
            background-image: linear-gradient(to right, #ff8177 0%, #ff867a 0%, #ff8c7f 21%, #f99185 52%, #cf556c 78%, #b12a5b 100%);
            color: white;
        }
        
        .legend { margin-top: 20px; font-size: 0.9em; background: #333; padding: 10px; border-radius: 5px; }
        .legend-item { display: flex; align-items: center; margin-bottom: 5px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; display: inline-block; border: 1px solid #fff; }
        
        #stats { font-family: monospace; color: #4facfe; margin-bottom: 10px; min-height: 45px; line-height: 1.4; }
    </style>
</head>
<body>

    <h1>Nuclear Chain Reaction Simulator</h1>
    <p>Visualizing protons (red) and neutrons (blue) inside the U-235 nucleus.</p>

    <div class="container">
        <canvas id="simCanvas" width="600" height="500"></canvas>

        <div class="controls">
            <div class="control-group">
                <label for="fuelDensity">Fuel Density (U-235 Quantity)</label>
                <input type="range" id="fuelDensity" min="10" max="150" value="60">
                <small>Amount: <span id="fuelVal">60</span></small>
            </div>

            <div class="control-group">
                <label style="background: #444; padding: 10px; border-radius: 5px; cursor: pointer;">
                    <input type="checkbox" id="moderatorToggle"> 
                    Enable Moderator (Water)
                    <br><small style="font-weight:normal; color:#ddd;">(Slows neutrons to allow fission)</small>
                </label>
            </div>
            
            <div class="control-group">
                <label for="neutronOutput">Neutrons per Fission</label>
                <select id="neutronOutput">
                    <option value="1">1 (Subcritical)</option>
                    <option value="2" selected>2 (Standard)</option>
                    <option value="3">3 (Supercritical)</option>
                </select>
            </div>

            <div class="control-group">
                <label for="controlRods">Control Rod Insertion Depth</label>
                <input type="range" id="controlRods" min="0" max="100" value="0">
            </div>

            <div id="stats">
                Status: Ready<br>
                Active Neutrons: 0
            </div>

            <button onclick="fireNeutron()">Launch Neutron</button>
            <button class="reset" onclick="init()">Reset / Regenerate Fuel</button>

            <div class="legend">
                <div class="legend-item"><span class="dot" style="background:linear-gradient(red, blue);"></span> U-235 Nucleus (Protons/Neutrons)</div>
                <div class="legend-item"><span class="dot" style="background:red;"></span> Thermal Neutron (Slow)</div>
                <div class="legend-item"><span class="dot" style="background:white;"></span> Fast Neutron (Quick)</div>
            </div>
        </div>
    </div>

<script>
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    
    let atoms = [];
    let neutrons = [];
    let particles = [];
    let fissionCount = 0;
    
    const ATOM_RADIUS = 12; // Slightly larger to see details
    const NEUTRON_RADIUS = 4;
    const FAST_SPEED = 7;     
    const THERMAL_SPEED = 2;  

    const fuelSlider = document.getElementById('fuelDensity');
    const fuelValDisplay = document.getElementById('fuelVal');
    const modCheckbox = document.getElementById('moderatorToggle');
    const neutronSelect = document.getElementById('neutronOutput');
    const rodSlider = document.getElementById('controlRods');
    const statsDiv = document.getElementById('stats');

    class Atom {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.active = true;
            // Pre-calculate sub-particle positions for efficiency
            this.nucleons = [];
            for(let i=0; i<12; i++) {
                this.nucleons.push({
                    dx: (Math.random() - 0.5) * 14,
                    dy: (Math.random() - 0.5) * 14,
                    type: Math.random() > 0.4 ? 'neutron' : 'proton'
                });
            }
        }
        draw() {
            if (!this.active) return;
            
            // Draw Nucleus Boundary
            ctx.beginPath();
            ctx.arc(this.x, this.y, ATOM_RADIUS, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(50, 205, 50, 0.2)'; // Faint green glow
            ctx.fill();

            // Draw individual protons and neutrons
            this.nucleons.forEach(n => {
                ctx.beginPath();
                ctx.arc(this.x + n.dx, this.y + n.dy, 3, 0, Math.PI * 2);
                ctx.fillStyle = n.type === 'proton' ? '#ff4d4d' : '#4d94ff';
                ctx.fill();
            });
        }
    }

    class Neutron {
        constructor(x, y, vx, vy, isThermal = false) {
            this.x = x;
            this.y = y;
            this.vx = vx;
            this.vy = vy;
            this.isThermal = isThermal;
        }

        update() {
            if (modCheckbox.checked) {
                if (!this.isThermal) {
                    this.vx *= 0.96; 
                    this.vy *= 0.96;
                    const speed = Math.sqrt(this.vx*this.vx + this.vy*this.vy);
                    if (speed <= THERMAL_SPEED) this.isThermal = true; 
                } else {
                    const speed = Math.sqrt(this.vx*this.vx + this.vy*this.vy);
                    if (speed < THERMAL_SPEED - 0.5) { this.vx *= 1.05; this.vy *= 1.05; }
                }
            } else {
                this.isThermal = false;
                const speed = Math.sqrt(this.vx*this.vx + this.vy*this.vy);
                if (speed < FAST_SPEED) { this.vx *= 1.1; this.vy *= 1.1; }
            }

            this.x += this.vx;
            this.y += this.vy;

            if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) return false; 

            const rodHeight = (rodSlider.value / 100) * canvas.height;
            const rodsX = [canvas.width * 0.25, canvas.width * 0.5, canvas.width * 0.75];
            for (let rx of rodsX) {
                if (this.x > rx - 10 && this.x < rx + 10 && this.y < rodHeight) return false; 
            }
            return true; 
        }

        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, NEUTRON_RADIUS, 0, Math.PI * 2);
            ctx.fillStyle = this.isThermal ? '#FF0000' : (modCheckbox.checked ? '#444' : '#FFF');
            ctx.fill();
            ctx.strokeStyle = this.isThermal ? '#FFF' : '#000'; 
            ctx.lineWidth = 1;
            ctx.stroke();
        }
    }

    class Particle {
        constructor(x, y, color) {
            this.x = x;
            this.y = y;
            const angle = Math.random() * Math.PI * 2;
            const speed = Math.random() * 4 + 1;
            this.vx = Math.cos(angle) * speed;
            this.vy = Math.sin(angle) * speed;
            this.life = 30;
            this.color = color;
        }
        update() {
            this.x += this.vx;
            this.y += this.vy;
            this.life--;
            return this.life > 0;
        }
        draw() {
            ctx.globalAlpha = this.life / 30;
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalAlpha = 1.0;
        }
    }

    function init() {
        atoms = [];
        neutrons = [];
        particles = [];
        fissionCount = 0;
        const count = parseInt(fuelSlider.value);
        fuelValDisplay.innerText = count;
        for (let i = 0; i < count; i++) {
            const x = Math.random() * (canvas.width - 40) + 20;
            const y = Math.random() * (canvas.height - 40) + 20;
            atoms.push(new Atom(x, y));
        }
        drawFrame();
        statsDiv.innerHTML = "Status: Awaiting Neutron Trigger";
    }

    function fireNeutron() {
        const y = Math.random() * (canvas.height - 100) + 50;
        neutrons.push(new Neutron(0, y, FAST_SPEED, (Math.random() - 0.5) * 2));
    }

    function checkCollisions() {
        for (let n = neutrons.length - 1; n >= 0; n--) {
            let neutron = neutrons[n];
            if (!neutron.isThermal) continue; 

            for (let i = atoms.length - 1; i >= 0; i--) {
                let atom = atoms[i];
                if (!atom.active) continue;

                const dx = atom.x - neutron.x;
                const dy = atom.y - neutron.y;
                const distSq = dx*dx + dy*dy;

                if (distSq < (ATOM_RADIUS + NEUTRON_RADIUS) ** 2) {
                    atom.active = false; 
                    fissionCount++;
                    
                    // Explosion particles use nucleon colors
                    atom.nucleons.forEach(nuc => {
                        particles.push(new Particle(atom.x, atom.y, nuc.type === 'proton' ? 'red' : 'blue'));
                    });

                    const releaseCount = parseInt(neutronSelect.value);
                    for (let k = 0; k < releaseCount; k++) {
                        const angle = Math.random() * Math.PI * 2;
                        neutrons.push(new Neutron(atom.x, atom.y, Math.cos(angle) * FAST_SPEED, Math.sin(angle) * FAST_SPEED, false));
                    }
                    neutrons.splice(n, 1);
                    break; 
                }
            }
        }
    }

    function drawFrame() {
        ctx.fillStyle = modCheckbox.checked ? '#b3e5fc' : '#000000'; 
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        const rodH = (rodSlider.value / 100) * canvas.height;
        ctx.fillStyle = '#666'; 
        const rodsX = [canvas.width * 0.25, canvas.width * 0.5, canvas.width * 0.75];
        for(let rx of rodsX) {
            ctx.fillRect(rx - 10, 0, 20, rodH);
        }

        atoms.forEach(a => a.draw());
        particles.forEach(p => p.draw());
        neutrons.forEach(n => n.draw());

        if (neutrons.length > 0) {
            statsDiv.innerHTML = `Status: Reacting<br>Active Neutrons: ${neutrons.length} | Fissions: ${fissionCount}`;
        } else if (fissionCount > 0) {
            statsDiv.innerHTML = `Status: Reaction Halted<br>Total Fissions: ${fissionCount}`;
        }
    }

    function animate() {
        for (let i = neutrons.length - 1; i >= 0; i--) { if (!neutrons[i].update()) neutrons.splice(i, 1); }
        for (let i = particles.length - 1; i >= 0; i--) { if (!particles[i].update()) particles.splice(i, 1); }
        checkCollisions();
        drawFrame();
        requestAnimationFrame(animate);
    }

    fuelSlider.addEventListener('input', init);
    window.onload = function() { init(); animate(); };
</script>
</body>
</html>
